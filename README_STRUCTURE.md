# Graffiti AI Bot - الهيكل الجديد المنظم 🎨

## 📁 هيكل الملفات

```
📦 Graffiti AI Bot
├── 📄 main.py                    # الملف الرئيسي لتشغيل البوت
├── 📄 config.py                  # إعدادات البوت والثوابت
├── 📄 session_manager.py         # إدارة جلسات المستخدمين
├── 📄 ai_services.py             # خدمات الذكاء الاصطناعي
├── 📄 basic_handlers.py          # معالجات الأوامر الأساسية
├── 📄 virtual_tryon_handlers.py  # معالجات تجربة الملابس
├── 📄 image_handlers.py          # معالجات توليد الصور
├── 📄 callback_handler.py        # معالج الأحداث والضغطات
├── 📄 reset_bot.py               # سكريبت إعادة تعيين API
├── 📄 start_bot.bat              # سكريبت تشغيل Windows
├── 📄 start_bot.ps1              # سكريبت تشغيل PowerShell
├── 📄 requirements.txt           # متطلبات المشروع
├── 📄 railway.json              # إعدادات النشر
├── 📄 bot_old.py                # النسخة الاحتياطية القديمة
├── 📄 .env                      # متغيرات البيئة (غير موجود)
└── 📄 README_STRUCTURE.md       # هذا الملف
```

## 🔧 وصف الملفات

### 📄 main.py
- الملف الرئيسي لتشغيل البوت
- يحتوي على دالة main() وإعداد المعالجات
- نقطة الدخول للتطبيق
- يتضمن معالجة محسنة للأخطاء

### 📄 config.py
- جميع الإعدادات والثوابت
- نماذج الذكاء الاصطناعي المتاحة
- رسائل البوت الثابتة
- متغيرات البيئة

### 📄 session_manager.py
- إدارة جلسات المستخدمين
- حفظ حالة كل مستخدم
- دوال مساعدة للجلسات

### 📄 ai_services.py
- خدمات الذكاء الاصطناعي الأساسية
- AIService - خدمة عامة
- VirtualTryOnService - تجربة الملابس
- ImageGenerationService - توليد الصور

### 📄 basic_handlers.py
- معالجات الأوامر الأساسية
- /start, /help, /about
- معالجة النصوص العامة

### 📄 virtual_tryon_handlers.py
- معالجات تجربة الملابس الافتراضية
- اختيار النماذج
- رفع ومعالجة الصور

### 📄 image_handlers.py
- معالجات توليد الصور
- معالجة النصوص لتوليد الصور
- ترجمة النصوص

### 📄 callback_handler.py
- معالج مركزي لجميع ضغطات الأزرار
- توجيه الأحداث للمعالجات المناسبة

### 📄 reset_bot.py
- سكريبت لحل مشاكل Telegram API
- إزالة webhooks المتعارضة
- مسح التحديثات المعلقة

## 🚀 كيفية التشغيل

### 📋 المتطلبات الأساسية
1. **تثبيت Python 3.8+ و pip**
2. **تثبيت المتطلبات:**
   ```bash
   pip install -r requirements.txt
   ```

3. **إنشاء ملف .env:**
   ```env
   TELEGRAM_TOKEN=your_telegram_bot_token
   GEMINI_API_KEY=your_gemini_api_key
   ```

### 🖥️ التشغيل المحلي

#### الطريقة الأولى: استخدام السكريپتات الجاهزة
```bash
# في Windows Command Prompt
start_bot.bat

# في PowerShell
.\start_bot.ps1
```

#### الطريقة الثانية: التشغيل اليدوي
```bash
# إعادة تعيين API أولاً (مهم!)
python reset_bot.py

# ثم تشغيل البوت
python main.py
```

### ☁️ النشر على Railway
1. **رفع الملفات لـ GitHub**
2. **ربط المشروع بـ Railway**
3. **إضافة متغيرات البيئة في Railway:**
   - `TELEGRAM_TOKEN`
   - `GEMINI_API_KEY`
4. **البوت سيعمل تلقائياً باستخدام `railway.json`**

### 🐛 حل مشاكل شائعة

#### مشكلة Telegram API Conflict (409)
```bash
# تشغيل سكريپت إعادة التعيين
python reset_bot.py
```

#### مشكلة التحديثات المعلقة
- استخدم `drop_pending_updates=True` في التشغيل
- أو شغل `reset_bot.py` قبل البوت

#### مشكلة عدة instances
- تأكد من إيقاف جميع عمليات البوت السابقة
- استخدم Task Manager لإيقاف python.exe

## ✨ مزايا الهيكل الجديد

### 🎯 فصل الاهتمامات (Separation of Concerns)
- كل ملف له وظيفة محددة
- سهولة العثور على الكود المطلوب
- تقليل التعقيد

### 🔧 سهولة الصيانة
- تعديل ميزة معينة في ملف واحد
- إضافة ميزات جديدة بسهولة
- اختبار أجزاء منفصلة

### 📈 قابلية التطوير
- إمكانية إضافة خدمات AI جديدة
- توسيع المعالجات بسهولة
- دعم المزيد من اللغات

### 🐛 تتبع الأخطاء
- أخطاء محددة لكل وحدة
- سجلات أكثر وضوحاً
- تشخيص أسرع للمشاكل

### 🛡️ استقرار أفضل
- معالجة محسنة لأخطاء الشبكة
- إعدادات polling محسنة
- سكريپت إعادة تعيين تلقائي

## 📋 قائمة المهام للتطوير

- [x] تقسيم الكود إلى ملفات منفصلة
- [x] إضافة معالجة محسنة للأخطاء
- [x] حل مشاكل Telegram API Conflicts
- [x] إضافة سكريپتات تشغيل آمنة
- [ ] إضافة خدمة قاعدة بيانات
- [ ] إضافة نظام إحصائيات
- [ ] إضافة اختبارات آلية
- [ ] دعم المزيد من اللغات
- [ ] تحسين الأداء

## 🔄 مقارنة مع الهيكل القديم

| الجانب | الهيكل القديم | الهيكل الجديد |
|---------|-------------|-------------|
| عدد الملفات | 1 ملف كبير | 11 ملف منظم |
| سطور الكود | +600 سطر في ملف واحد | ~100 سطر لكل ملف |
| سهولة الصيانة | صعبة | سهلة جداً |
| إضافة ميزات | معقدة | بسيطة |
| تتبع الأخطاء | صعب | واضح ومحدد |
| استقرار التشغيل | مشاكل متكررة | مستقر وموثوق |
| حل المشاكل | تعديل كامل للملف | تعديل ملف واحد |

## 🤝 المساهمة

عند إضافة ميزات جديدة:
1. حدد الملف المناسب للتعديل
2. إذا كانت ميزة جديدة كبيرة، أنشئ ملف منفصل
3. حافظ على فصل الاهتمامات
4. أضف التوثيق والتعليقات
5. اختبر باستخدام `reset_bot.py` قبل التشغيل

## 📞 الدعم

في حالة مواجهة مشاكل:
1. **شغل `reset_bot.py` أولاً**
2. **تأكد من متغيرات البيئة**
3. **راجع سجلات الأخطاء**
4. **تأكد من عدم وجود instances أخرى تعمل**

---

> تم إنشاء هذا الهيكل لتحسين تنظيم وصيانة وأستقرار بوت Graffiti AI 🎨
